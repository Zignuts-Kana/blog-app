<%- include("../partials/blog/header.ejs") %>
  <!-- Page content-->
  <div class="container">
    <% if(letestBlog.length && categoryList.length) { %>
      <div class="d-flex">
        <!-- Blog entries-->
        <div class="col-lg-8">
          <!-- Featured blog post-->
          <div class="card mb-4">
            <a href=/?slug=<%- letestBlog[0].slug %>
              ><img class="card-img-top" src="uploads/<%- letestBlog[0].imageThumbnail[0].filename %>" alt="..."
                style=height:350px;width:728px;object-fit:contain /></a>
            <div class="card-body">
              <div class="small text-muted"><%- letestBlog[0].date %></div>
              <h2 class="card-title"><%- letestBlog[0].title %></h2>
              <p class="card-text">
                <%- letestBlog[0].description %>...
              </p>
              <a class="btn btn-primary" href="#!">Read more →</a>
            </div>
          </div>
          <!-- Nested row for non-featured blog posts-->
          <% if(typeof searchedBlogs !== undefined && searchedBlogs.length) { %>
            <div class="row" id="serchDataViewer">
              <% for(let i=0 ; i<searchedBlogs.length ; i=i+2) {%>
                <div class="col-lg-6">
                  <!-- Blog post-->
                  <div class="card mb-4">
                    <a href=/?slug=<%- searchedBlogs[i].slug %>
                      ><img class="card-img-top" src="uploads/<%- searchedBlogs[i].imageThumbnail[0].filename  %>"
                        alt="..." /></a>
                    <div class="card-body">
                      <div class="small text-muted"> <%- searchedBlogs[i].date %></div>
                      <h2 class="card-title h4"><%- searchedBlogs[i].title %></h2>
                      <p class="card-text">
                        <%- searchedBlogs[i].description %>...
                      </p>
                      <a class="btn btn-primary" href=/?slug=<%- searchedBlogs[i].slug %>>Read more →</a>
                    </div>
                  </div>
                  <!-- Blog post-->
                  <% if(searchedBlogs[i+1]) { %>
                    <div class="card mb-4">
                      <a href=/?slug=<%- searchedBlogs[i+1].slug %>
                        ><img class="card-img-top" src="uploads/<%- searchedBlogs[i+1].imageThumbnail[0].filename  %>"
                          alt="..." /></a>
                      <div class="card-body">
                        <div class="small text-muted"><%- searchedBlogs[i+1].date %></div>
                        <h2 class="card-title h4"><%- searchedBlogs[i+1].title %></h2>
                        <p class="card-text">
                          <%- searchedBlogs[i+1].description %>...
                        </p>
                        <a class="btn btn-primary" href=/?slug=<%- searchedBlogs[i+1].slug %>>Read more →</a>
                      </div>
                    </div>
                    <%}%>
                </div>
                <% } %>
            </div>
            <% } %>
          <% if(typeof otherBlogs !== undefined && otherBlogs.length) { %>
            <div class="row" id="serchDataViewer">
              <% for(let i=0 ; i<otherBlogs.length ; i=i+2) {%>
                <div class="col-lg-6">
                  <!-- Blog post-->
                  <div class="card mb-4">
                    <a href=/?slug=<%- otherBlogs[i].slug %>
                      ><img class="card-img-top" src="uploads/<%- otherBlogs[i].imageThumbnail[0].filename  %>"
                        alt="..." /></a>
                    <div class="card-body">
                      <div class="small text-muted"> <%- otherBlogs[i].date %></div>
                      <h2 class="card-title h4"><%- otherBlogs[i].title %></h2>
                      <p class="card-text">
                        <%- otherBlogs[i].description %>...
                      </p>
                      <a class="btn btn-primary" href=/?slug=<%- otherBlogs[i].slug %>>Read more →</a>
                    </div>
                  </div>
                  <!-- Blog post-->
                  <% if(otherBlogs[i+1]) { %>
                    <div class="card mb-4">
                      <a href=/?slug=<%- otherBlogs[i+1].slug %>
                        ><img class="card-img-top" src="uploads/<%- otherBlogs[i+1].imageThumbnail[0].filename  %>"
                          alt="..." /></a>
                      <div class="card-body">
                        <div class="small text-muted"><%- otherBlogs[i+1].date %></div>
                        <h2 class="card-title h4"><%- otherBlogs[i+1].title %></h2>
                        <p class="card-text">
                          <%- otherBlogs[i+1].description %>...
                        </p>
                        <a class="btn btn-primary" href=/?slug=<%- otherBlogs[i+1].slug %>>Read more →</a>
                      </div>
                    </div>
                    <%}%>
                </div>
                <% } %>
            </div>
            <% } %>
              <!-- Pagination-->
              <nav aria-label="Pagination">
                <hr class="my-0" />
                <ul class="pagination justify-content-center my-4">
                  <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">
                      <i class="fas fa-angle-left"></i>
                      <span class="sr-only">Previous</span>
                    </a>
                  </li>
                  <li class="page-item active" aria-current="page">
                    <a class="page-link" href="#!">1</a>
                  </li>
                  <li class="page-item"><a class="page-link" href="#!">2</a></li>
                  <li class="page-item"><a class="page-link" href="#!">3</a></li>
                  <li class="page-item disabled">
                    <a class="page-link" href="#!">...</a>
                  </li>
                  <li class="page-item"><a class="page-link" href="#!">15</a></li>
                  <li class="page-item"><a class="page-link" href="#">
                      <i class="fas fa-angle-right"></i>
                      <span class="sr-only">Next</span>
                    </a></li>
                </ul>
              </nav>
        </div>
        <!-- Side widgets-->
        <div class="col-4">
          <!-- Search widget-->
          <div class="card mb-4">
            <div class="card-header">Search</div>
            <div class="card-body">
              <div class="input-group" id="searchChangeButtonBack">
                <input class="form-control" type="text" placeholder="Enter search term..." id="search"
                  aria-label="Enter search term..." aria-describedby="button-search" />
                <button class="btn btn-primary" onclick="searchBlog()" type="button">
                  Go!
                </button>
              </div>
            </div>
          </div>
          <!-- Categories widget-->
          <div class="card mb-4">
            <div class="card-header">Categories</div>
            <div class="card-body">
              <div class="row">
                <% for (let i=0 ; i<categoryList.length ; i++ ) { %>
                  <div class="col-sm-6">
                    <ul class="list-unstyled mb-0">
                      <li><a href="/?category=<%- categoryList[i].name %>"><%- categoryList[i].name %></a></li>
                    </ul>
                  </div>
                  <% } %>
              </div>
            </div>
          </div>
          <!-- Side widget-->
          <div class="card mb-4">
            <div class="card-header">Side Widget</div>
            <div class="card-body">
              You can put anything you want inside of these side widgets. They are
              easy to use, and feature the Bootstrap 5 card component!
            </div>
          </div>
        </div>
      </div>
      <% } else { %>
        <div class="container" style="height: 32.84vh;">
          <h2> No Any Blog Posted Yet... </h2>
          <h4>Stay Connected For Update</h4>
        </div>
        <% } %>
  </div>
  <script>
    $(document).ready(function () {
      $('#example').DataTable();
    });
    <% if (searchedBlogs.length) { %>

      const searchChangeButtonBack = document.getElementById('searchChangeButtonBack');
      console.log(searchChangeButtonBack);
      if (searchChangeButtonBack) {
        searchChangeButtonBack.innerHTML = `<input class="form-control" type="text" placeholder="Enter search term..." id="search"
                  aria-label="Enter search term..." aria-describedby="button-search" />
                <a href="/blog" class="btn btn-primary" onclick="searchBlog()" type="button">
                  Back Home
                </a>`
      }
      <% } else {%>
        let responseData;
    function searchBlog (e) {
      const search = document.getElementById('search').value;
      const userAction = async () => {
        const response = await fetch(`http://localhost:3000/journal/search/${search}`, {
          method: "GET",
          headers: {
            'Accept': 'text/html, application/xhtml+xml, application/xml;q=0.9, image/webp, */*',
            "Authorization": `Bearer ${localStorage.getItem('token')}`
          },
        });
        responseData = await response.text();
        document.write(responseData);
      };
      userAction();
    }
        <% } %>
      <% if (typeof user != 'undefined' && typeof token != 'undefined') { %>
  const user = {
        _id: "<%= user._id %>",
        name: '<%= user.name %>',
        role: '<%= user.role %>',
        email: '<%= user.email %>',
        token: '<%= user.token %>'
      };
      localStorage.setItem('user', JSON.stringify(user));
      localStorage.setItem('token', '<%- token %>');
      
      window.location.href = `http://localhost:3000/?blog="true"`
        <% } %>

  </script>
  <%- include('../partials/blog/footer.ejs') %>